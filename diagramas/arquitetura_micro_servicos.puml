@startuml
!theme vibrant
skinparam {
  backgroundColor transparent
  roundcorner 12
  shadowing true

  package {
    BackgroundColor #f8fafc
    BorderColor #e2e8f0
    BorderThickness 2
    FontColor #1e293b
    FontSize 12
  }

  component {
    BackgroundColor #ffffff
    BorderColor #475569
    FontColor #334155
    BorderThickness 2
    roundcorner 10
    FontSize 11
  }

  database {
    BackgroundColor #f1f5f9
    BorderColor #64748b
    FontColor #475569
    BorderThickness 2
    roundcorner 8
  }

  arrow {
    Color #0ea5e9
    thickness 2
  }

  defaultFontName "Inter"
  defaultFontSize 11
}

title <size:18><color:#0f172a><b>IDBRA - Arquitetura de Microservi√ßos</b></color>\n<size:13><color:#64748b>Sistema de Identidade Digital Descentralizada - Ambiente Enterprise</color></size>

' ===============================
' EXTERNAL INTERFACES
' ===============================
package "üåê **Front-end & Gateway**" as EXTERNAL #f0f9ff {
  component [üíª **Portal Web**\nReact.js + TypeScript\nInterface Institucional] as WEB_CLIENT #3b82f6
  component [üì± **Mobile App**\nReact Native\nCarteira Digital] as MOBILE_CLIENT #8b5cf6
  component [üîå **API Gateway**\nNGINX + Kong\nLoad Balancer] as API_GATEWAY #06b6d4
}

' ===============================
' MICROSERVICES LAYER
' ===============================
package "‚öôÔ∏è **Camada de Microservi√ßos**" as MICROSERVICES #f8fafc {

  component [üîê **CUSTODY**\n<size:10>:8082</size>\n\n‚Ä¢ Wallet Management\n‚Ä¢ Crypto Operations\n‚Ä¢ Blockchain Bridge\n‚Ä¢ HSM Integration] as CUSTODY_SVC #f59e0b

  component [üèõÔ∏è **ISSUER**\n<size:10>:8083</size>\n\n‚Ä¢ Credential Issuance\n‚Ä¢ StatusList Management\n‚Ä¢ Digital Signatures\n‚Ä¢ Revocation Control] as ISSUER_SVC #10b981

  component [üë§ **HOLDER**\n<size:10>:8084</size>\n\n‚Ä¢ Personal Wallet\n‚Ä¢ Credential Storage\n‚Ä¢ Privacy Controls\n‚Ä¢ Self-Sovereign ID] as HOLDER_SVC #8b5cf6

  component [‚úÖ **VERIFIER**\n<size:10>:8085</size>\n\n‚Ä¢ Credential Validation\n‚Ä¢ Status Verification\n‚Ä¢ Compliance Checks\n‚Ä¢ Audit Trails] as VERIFIER_SVC #ef4444
}

' ===============================
' BLOCKCHAIN INFRASTRUCTURE
' ===============================
package "‚õìÔ∏è **Blockchain Infrastructure**" as BLOCKCHAIN #fef2f2 {
  component [üåê **Hyperledger Besu**\n<color:#64748b>Private Permissioned Network</color>\n\n‚Ä¢ IBFT 2.0 Consensus\n‚Ä¢ 4 Institutional Validators\n‚Ä¢ 1000+ TPS Performance\n‚Ä¢ <3s Block Finality] as BESU_NETWORK #dc2626

  component [üìã **Smart Contracts**\n<color:#64748b>Ethereum Compatible</color>\n\n‚Ä¢ DID Registry (EIP-1056)\n‚Ä¢ StatusList2021 (W3C)\n‚Ä¢ Governance Framework\n‚Ä¢ Upgrade Mechanisms] as SMART_CONTRACTS #b91c1c
}

' ===============================
' DATA PERSISTENCE
' ===============================
package "üíæ **Data & Storage Layer**" as DATA_LAYER #f0fdf4 {
  database [üìä **MongoDB Custody**\n<color:#64748b>Encrypted Metadata</color>\n\n‚Ä¢ Wallet Configurations\n‚Ä¢ Transaction Logs\n‚Ä¢ Cryptographic Keys\n‚Ä¢ Security Policies] as DB_CUSTODY #059669

  database [üìä **MongoDB Issuer**\n<color:#64748b>Credential Registry</color>\n\n‚Ä¢ VC Templates\n‚Ä¢ StatusList Storage\n‚Ä¢ Issuance History\n‚Ä¢ Audit Trails] as DB_ISSUER #0d9488

  database [üìä **MongoDB Holder**\n<color:#64748b>Personal Vault</color>\n\n‚Ä¢ User Credentials\n‚Ä¢ Privacy Settings\n‚Ä¢ Access History\n‚Ä¢ Consent Records] as DB_HOLDER #7c3aed

  database [üìä **MongoDB Verifier**\n<color:#64748b>Validation Cache</color>\n\n‚Ä¢ Verification Logs\n‚Ä¢ Performance Metrics\n‚Ä¢ Compliance Reports\n‚Ä¢ Trust Scores] as DB_VERIFIER #0ea5e9
}

' ===============================
' SECURITY & OBSERVABILITY
' ===============================
package "üîí **Security & Observability**" as SECURITY #fffbeb {
  component [üõ°Ô∏è **Security Stack**\n<color:#64748b>Enterprise Grade</color>\n\n‚Ä¢ Thales SafeNet HSM\n‚Ä¢ JWT/OAuth 2.0\n‚Ä¢ mTLS Encryption\n‚Ä¢ Zero Trust Network] as SECURITY_STACK #f59e0b

  component [üìä **Observability**\n<color:#64748b>Full Stack Monitoring</color>\n\n‚Ä¢ Prometheus Metrics\n‚Ä¢ Grafana Dashboards\n‚Ä¢ ELK Log Analytics\n‚Ä¢ Jaeger Tracing] as OBSERVABILITY #d97706

  component [üö® **Compliance Engine**\n<color:#64748b>Regulatory Framework</color>\n\n‚Ä¢ LGPD Compliance\n‚Ä¢ SOX Controls\n‚Ä¢ PCI DSS Level 1\n‚Ä¢ ISO 27001] as COMPLIANCE #ea580c
}

' ===============================
' EXTERNAL CONNECTIONS
' ===============================
WEB_CLIENT -down-> API_GATEWAY : <color:#3b82f6><b>HTTPS/WSS</b></color>
MOBILE_CLIENT -down-> API_GATEWAY : <color:#8b5cf6><b>REST API</b></color>

API_GATEWAY -down-> CUSTODY_SVC : <color:#f59e0b><b>Secure Bridge</b></color>
API_GATEWAY -down-> ISSUER_SVC : <color:#10b981><b>Issuance Flow</b></color>
API_GATEWAY -down-> HOLDER_SVC : <color:#8b5cf6><b>Wallet Access</b></color>
API_GATEWAY -down-> VERIFIER_SVC : <color:#ef4444><b>Verification</b></color>

' ===============================
' MICROSERVICES TO DATA
' ===============================
CUSTODY_SVC -down-> DB_CUSTODY : <color:#059669><b>Encrypted I/O</b></color>
ISSUER_SVC -down-> DB_ISSUER : <color:#0d9488><b>Credential Store</b></color>
HOLDER_SVC -down-> DB_HOLDER : <color:#7c3aed><b>Personal Data</b></color>
VERIFIER_SVC -down-> DB_VERIFIER : <color:#0ea5e9><b>Validation Cache</b></color>

' ===============================
' MICROSERVICES TO BLOCKCHAIN
' ===============================
CUSTODY_SVC -down-> BESU_NETWORK : <color:#dc2626><b>Wallet Ops</b></color>
ISSUER_SVC -down-> BESU_NETWORK : <color:#dc2626><b>Registration</b></color>
VERIFIER_SVC -down-> BESU_NETWORK : <color:#dc2626><b>Validation</b></color>

ISSUER_SVC -down-> SMART_CONTRACTS : <color:#b91c1c><b>Contract Calls</b></color>
VERIFIER_SVC -down-> SMART_CONTRACTS : <color:#b91c1c><b>Status Queries</b></color>

' ===============================
' INTER-SERVICE COMMUNICATION
' ===============================
CUSTODY_SVC <-right-> ISSUER_SVC : <color:#64748b><b>Internal gRPC</b></color>
ISSUER_SVC <-right-> HOLDER_SVC : <color:#64748b><b>Credential Sync</b></color>
HOLDER_SVC <-right-> VERIFIER_SVC : <color:#64748b><b>Verify Request</b></color>
VERIFIER_SVC <-left-> CUSTODY_SVC : <color:#64748b><b>Status Check</b></color>

' ===============================
' SECURITY CONNECTIONS
' ===============================
SECURITY_STACK -up-> CUSTODY_SVC : <color:#f59e0b><b>HSM</b></color>
OBSERVABILITY -up-> MICROSERVICES : <color:#d97706><b>Metrics</b></color>
COMPLIANCE -up-> MICROSERVICES : <color:#ea580c><b>Audit</b></color>

' ===============================
' ARCHITECTURAL NOTES
' ===============================
note top of EXTERNAL #f0f9ff
  <color:#3b82f6><b>üéØ Client Layer</b></color>
  ‚Ä¢ Modern SPA Architecture
  ‚Ä¢ Progressive Web App (PWA)
  ‚Ä¢ Mobile-First Design
  ‚Ä¢ OAuth 2.0 + PKCE
end note

note top of BLOCKCHAIN #fef2f2
  <color:#dc2626><b>‚õìÔ∏è Distributed Ledger</b></color>
  ‚Ä¢ Byzantine Fault Tolerance
  ‚Ä¢ Institutional Governance
  ‚Ä¢ Enterprise Performance
  ‚Ä¢ Regulatory Compliance
end note

note bottom of DATA_LAYER #f0fdf4
  <color:#059669><b>üíæ Data Architecture</b></color>
  ‚Ä¢ Document-Based Storage
  ‚Ä¢ Horizontal Scaling
  ‚Ä¢ Automatic Sharding
  ‚Ä¢ Point-in-Time Recovery
  ‚Ä¢ AES-256 Encryption at Rest
end note

note bottom of SECURITY #fffbeb
  <color:#f59e0b><b>üîí Zero Trust Security</b></color>
  ‚Ä¢ Hardware Security Module
  ‚Ä¢ End-to-End Encryption
  ‚Ä¢ Multi-Factor Authentication
  ‚Ä¢ Continuous Compliance
  ‚Ä¢ 24/7 SOC Monitoring
end note

@enduml
